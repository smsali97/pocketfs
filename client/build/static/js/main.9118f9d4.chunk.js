(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{207:function(e,t,n){},208:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),s=n(13),r=n.n(s);n(90),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var c=n(8),i=n(75),l=n(76),h=n(81),u=n(77),f=n(82),d=n(21),m=n.n(d),p=n(49),g=n.n(p),v=n(230),k=n(227),F=n(231),y=n(229),E=n(232),w=n(79),b=(Object(k.a)((function(e){return{root:{"& > *":{margin:e.spacing(1)}},input:{display:"none"},blue:{color:"lightblue"}}})),function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(n=Object(h.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).ws=new WebSocket("ws://localhost:8000/ws"),n.state={snackBarError:!1,snackBarMessage:"",files:[],servers:[]},n.fetchFiles=function(){n.setState(Object(c.a)({},n.state,{isFetching:!0})),0!==n.state.servers.length?(n.setState(Object(c.a)({},n.state,{snackBarError:!1,snackBarMessage:""})),fetch("http://"+n.state.servers[0].ip+":8080/directory").then((function(e){return e.json()})).then((function(e){e.forEach((function(e){e.modified=m()(e.modified)})),n.setState(Object(c.a)({},n.state,{files:e,isFetching:!1}))})).catch((function(e){n.state.servers.shift(),console.log(e)}))):n.setState(Object(c.a)({},n.state,{snackBarError:!0,snackBarMessage:"Unable to get directory.. no servers online :("}))},n.handleDownloadFile=function(e){e.forEach((function(e){Object(w.saveAs)("http://"+n.state.servers[0].ip+":8080/download?path="+e,e)}))},n.handleClose=function(e,t){"clickaway"!==t&&n.setState((function(e){e.snackBarError=!1,e.snackBarMessage=""}))},n.handleCreateFolder=function(e){fetch("http://"+n.state.servers[0].ip+":8080/directory?path="+e.slice(0,-1),{method:"POST"}).then((function(e){var t=e.headers.get("status");console.log(e),200!==t&&e.text().then((function(e){n.setState((function(t){t.snackBarError=!0,t.snackBarMessage=e}))}))}))},n.handleCreateFiles=function(e,t){console.log(e),console.log(t),e.forEach((function(e){var a=new FormData;a.append("myFile",e),""!==t&&(t=t.slice(0,-1));var o={method:"POST",body:a};fetch("http://"+n.state.servers[0].ip+":8080/upload?path="+t,o).then((function(e){var t=e.headers.get("status");console.log(e),200!==t&&e.text().then((function(e){n.setState((function(t){t.snackBarError=!0,t.snackBarMessage=e}))}))}))}))},n.handleRenameFolder=function(e,t){n.setState((function(n){var a=[];return n.files.map((function(n){n.key.substr(0,e.length)===e?a.push(Object(c.a)({},n,{key:n.key.replace(e,t),modified:+m()()})):a.push(n)})),n.files=a,n}))},n.handleRenameFile=function(e,t){n.setState((function(n){var a=[];return n.files.map((function(n){n.key===e?a.push(Object(c.a)({},n,{key:t,modified:+m()()})):a.push(n)})),n.files=a,n}))},n.handleDeleteFolder=function(e){e=e[0].slice(0,-1),console.log(e),fetch("http://"+n.state.servers[0].ip+":8080/directory?path="+e,{method:"DELETE"}).then((function(e){var t=e.headers.get("status");console.log(e),200!==t&&e.text().then((function(e){n.setState((function(t){t.snackBarError=!0,t.snackBarMessage=e}))}))}))},n.handleDeleteFile=function(e){var t=e[0];fetch("http://"+n.state.servers[0].ip+":8080/remove?path="+t,{method:"POST"}).then((function(e){var t=e.headers.get("status");console.log(e),200!==t&&e.text().then((function(e){n.setState((function(t){t.snackBarError=!0,t.snackBarMessage=e}))}))}))},n}return Object(f.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.timer=setInterval((function(){return e.fetchFiles()}),5e3)}},{key:"componentWillMount",value:function(){var e=this;this.ws.onopen=function(){console.log("connected to proxy :)")},this.ws.onmessage=function(t){var n=t.data;if(n.includes("PING")){var a=JSON.parse(n.replace("PING ","")),o=e.state.servers.filter((function(e){return e.ip!==a.ip}));o.push(a),o.sort((function(e,t){return e.latency-t.latency})),e.setState(Object(c.a)({},e.state,{servers:o})),console.log(e.state.servers)}},this.ws.onclose=function(){console.log("disconnected from proxy :("),e.ws=new WebSocket("ws://localhost:8000/ws")}}},{key:"componentWillUnmount",value:function(){this.timer=null}},{key:"render",value:function(){return o.a.createElement(y.a,{container:!0,spacing:3},o.a.createElement(y.a,{item:!0,xs:12,container:!0,spacing:0,direction:"column",alignItems:"center",justify:"center"},o.a.createElement("img",{src:"lifting-1TB.png"}),o.a.createElement(v.a,{variant:"h7",component:"h7",gutterBottom:!0},o.a.createElement("em",null,this.state.servers.length," Pocket Gopher",1!==this.state.servers.length?"s are":" is"," available to serve you files!")),o.a.createElement(v.a,{variant:"h3",component:"h2",gutterBottom:!0},o.a.createElement("em",null,"PocketFS -")," Distributed File System"),o.a.createElement(E.a,{open:this.state.snackBarError,autoHideDuration:6e3,onClose:this.handleClose},o.a.createElement(v.a,{variant:"h5",component:"h5",gutterBottom:!0},this.state.snackBarMessage)),o.a.createElement(F.a,{className:!0},o.a.createElement(g.a,{files:this.state.files,icons:p.Icons.FontAwesome(4),onDownloadFile:this.handleDownloadFile,onCreateFolder:this.handleCreateFolder,onCreateFiles:this.handleCreateFiles,onMoveFolder:this.handleRenameFolder,onMoveFile:this.handleRenameFile,onRenameFolder:this.handleRenameFolder,onDeleteFolder:this.handleDeleteFolder,onDeleteFile:this.handleDeleteFile}))))}}]),t}(o.a.Component));n(207);r.a.render(o.a.createElement(b,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},85:function(e,t,n){e.exports=n(208)},90:function(e,t,n){}},[[85,1,2]]]);
//# sourceMappingURL=main.9118f9d4.chunk.js.map